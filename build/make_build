#!/bin/bash
set -ex

# Load variables
#
# Load all variables used in the build process.
for vars in variable*; do
   source $vars
done
source versions/${IMAGE_VERSION}

# Execution
#
# Executing the script.
TEMP_TAG=$(date +%Y%m%d%H%M%S)-dev
CONTAINER_IMAGE=${IMAGE}:${TEMP_TAG}
docker build \
    --build-arg BUILD_DATE="${DATE}"\
    --build-arg VERSION="${VERSION}"\
    --build-arg S6_OVERLAY_VERSION="${S6_OVERLAY_VERSION}"\
    --build-arg S6_OVERLAY_URL="${S6_OVERLAY_URL}"\
    --pull -t ${CONTAINER_IMAGE} ../.

echo "${CONTAINER_IMAGE}" > CONTAINER_IMAGE.var